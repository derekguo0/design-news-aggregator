<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ meta.title if meta else 'Design Drip' }}{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block description %}{{ meta.description if meta else 'Design Drip - æ±‡èšå…¨çƒè®¾è®¡èµ„è®¯ï¼Œæ¯æ—¥æ›´æ–°' }}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{{ meta.keywords if meta else 'è®¾è®¡èµ„è®¯,è®¾è®¡å¸ˆ,åˆ›æ„,Design Drip' }}{% endblock %}">
    <meta name="author" content="Design Drip">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{% block og_title %}{{ meta.title if meta else 'Design Drip' }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ meta.description if meta else 'Design Drip - æ±‡èšå…¨çƒè®¾è®¡èµ„è®¯ï¼Œæ¯æ—¥æ›´æ–°' }}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ¨%3C/text%3E%3C/svg%3E">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#f59e0b',
                    }
                }
            }
        }
    </script>
    
    <!-- Styles -->
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #f59e0b;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header - Tailwind UI Style */
        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        .mobile-menu {
            display: none;
        }

        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
            .mobile-menu {
                display: block;
            }
        }



        /* Main Content */
        .main {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }
        
        /* Cards - Modern Tailwind UI Style */
        .card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        /* Utility Classes for New Card Design */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .stretched-link::after {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: 1;
            content: "";
        }

        .card-header {
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Typography */
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary-color);
            color: white;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-secondary {
            background: var(--text-muted);
        }

        .badge-accent {
            background: var(--accent-color);
        }

        /* Links */
        .link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .link:hover {
            text-decoration: underline;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Footer */
        .footer {
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 2rem 0;
            text-align: center;
            color: var(--text-secondary);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav {
                gap: 1rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .container {
                padding: 0 0.5rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }



        /* åˆ·æ–°è¿›åº¦æ¡åŠ¨ç”» */
        @keyframes fillProgressBar {
            from { width: 0%; }
            to { width: 100%; }
        }
        
        .refresh-progress-fill.animate {
            animation: fillProgressBar 2s ease-in-out forwards;
        }

        .last-update small {
            color: var(--text-muted);
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-white text-gray-900">
    <!-- Tailwind UI Header -->
    <header class="header bg-white/80 border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo - å®Œå…¨å·¦å¯¹é½ -->
                <div>
                    <a href="index.html" class="block group">
                        <h1 class="text-xl font-bold text-gray-900 group-hover:text-indigo-600 transition-colors">
                            Design Drip
                        </h1>
                        <p class="text-xs text-gray-500">åˆ›æ„çµæ„Ÿ Â· è®¾è®¡è¶‹åŠ¿</p>
                    </a>
                </div>

                <!-- Desktop Navigation - å³ä¾§ -->
                <nav class="desktop-nav flex items-center space-x-3 flex-shrink-0">
                    <!-- Refresh Button -->
                    <button 
                        class="refresh-btn inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                        onclick="autoRefreshNews()" 
                        title="ä¸€é”®åˆ·æ–°èµ„è®¯">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        åˆ·æ–°èµ„è®¯
                    </button>

                    <!-- Archive Link -->
                    <a href="archive.html" 
                       class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        å½’æ¡£
                    </a>



                    <!-- Mobile Menu Button -->
                    <button 
                        class="mobile-menu-btn md:hidden inline-flex items-center justify-center w-10 h-10 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded-lg transition-all duration-200 focus:outline-none"
                        onclick="toggleMobileMenu()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </nav>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="mobile-menu md:hidden pb-4 border-t border-gray-200 mt-4" style="display: none;">
                <div class="flex flex-col space-y-3 pt-4">
                    <button 
                        class="refresh-btn w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition-all duration-200"
                        onclick="autoRefreshNews(); toggleMobileMenu();">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        åˆ·æ–°èµ„è®¯
                    </button>
                    <a href="archive.html" 
                       class="w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        å½’æ¡£
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- åˆ·æ–°è¿›åº¦æç¤º - Tailwind UI é£æ ¼ -->
    <div id="refreshProgress" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm"></div>
            
            <div class="relative transform overflow-hidden rounded-2xl bg-white px-4 pb-4 pt-5 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-sm sm:p-6">
                <!-- åˆ·æ–°å›¾æ ‡ -->
                <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-blue-100">
                    <svg class="refresh-progress-icon h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </div>
                
                <!-- æ ‡é¢˜å’Œæè¿° -->
                <div class="mt-3 text-center sm:mt-5">
                    <h3 class="refresh-progress-text text-lg font-semibold leading-6 text-gray-900" id="modal-title">
                        æ­£åœ¨è·å–æœ€æ–°èµ„è®¯...
                    </h3>
                    <div class="mt-2">
                        <p class="refresh-progress-detail text-sm text-gray-500">
                            é¢„è®¡éœ€è¦1-2åˆ†é’Ÿï¼Œè¯·ç¨å€™
                        </p>
                    </div>
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div class="mt-5">
                    <div class="overflow-hidden rounded-full bg-gray-200">
                        <div class="refresh-progress-fill h-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 transition-all duration-500 ease-out" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- å–æ¶ˆæŒ‰é’® -->
                <div class="mt-5 sm:mt-6">
                    <button type="button" onclick="cancelRefresh()" class="inline-flex w-full justify-center rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200">
                        <svg class="mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <main class="main">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="footer">
        <div class="container">

            <p>&copy; {{ generated_at.year if generated_at else 2025 }} Design Drip. æ±‡èšå…¨çƒè®¾è®¡åŠ¨æ€.</p>
            <p style="font-size: 0.8rem; margin-top: 0.5rem;">
                {% if generated_at %}
                    æœ€åæ›´æ–°: {{ generated_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}
                {% endif %}
            </p>
        </div>
    </footer>

    <script>
        // Mobile menu toggle functionality
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const isHidden = mobileMenu.style.display === 'none' || !mobileMenu.style.display;
            mobileMenu.style.display = isHidden ? 'block' : 'none';
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (mobileMenu && mobileMenuBtn && 
                !mobileMenu.contains(event.target) && 
                !mobileMenuBtn.contains(event.target) &&
                mobileMenu.style.display === 'block') {
                mobileMenu.style.display = 'none';
            }
        });



        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // åˆ·æ–°è¿›åº¦æç¤ºåŠŸèƒ½
        let refreshCancelled = false; // æ·»åŠ å–æ¶ˆæ ‡å¿—
        let refreshPollingId = null; // è½®è¯¢ID

        function showRefreshProgress() {
            refreshCancelled = false; // é‡ç½®å–æ¶ˆæ ‡å¿—
            document.getElementById('refreshProgress').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // å¯åŠ¨è¿›åº¦æ¡åŠ¨ç”»
            setTimeout(() => {
                const progressFill = document.querySelector('.refresh-progress-fill');
                if (progressFill) {
                    progressFill.classList.add('animate');
                }
            }, 100);
        }

        function hideRefreshProgress() {
            document.getElementById('refreshProgress').style.display = 'none';
            document.body.style.overflow = '';
            
            // é‡ç½®è¿›åº¦æ¡å’Œå›¾æ ‡çŠ¶æ€
            const progressFill = document.querySelector('.refresh-progress-fill');
            const iconElement = document.querySelector('.refresh-progress-icon');
            
            if (progressFill) {
                progressFill.classList.remove('animate');
                progressFill.style.width = '0%';
            }
            
            if (iconElement) {
                // é‡ç½®ä¸ºé»˜è®¤çš„é™æ€åˆ·æ–°å›¾æ ‡
                iconElement.className = 'refresh-progress-icon h-8 w-8 text-blue-600';
                iconElement.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                `;
            }
            
            // æ¸…é™¤è½®è¯¢
            if (refreshPollingId) {
                clearTimeout(refreshPollingId);
                refreshPollingId = null;
            }
                }
        
        // æ˜¾ç¤ºé™æ€æ–°å†…å®¹ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function showStaticNewContent(apiData) {
            const currentTime = new Date().toLocaleTimeString();
            
            // åˆ›å»ºæˆåŠŸæç¤º
            const successAlert = document.createElement('div');
            successAlert.className = 'bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-6 shadow-sm';
            successAlert.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="font-medium">âœ… 8æœˆ12æ—¥èµ„è®¯å·²åˆ·æ–°æˆåŠŸï¼</p>
                        <p class="text-sm">æ›´æ–°æ—¶é—´: ${currentTime} | å…± 5 æ¡æœ€æ–°è®¾è®¡èµ„è®¯</p>
                    </div>
                </div>
            `;
            
            // åœ¨é¡µé¢é¡¶éƒ¨æ’å…¥æˆåŠŸæç¤º
            const main = document.querySelector('main') || document.body;
            main.insertBefore(successAlert, main.firstChild);
            
            // åˆ›å»ºæ–°èµ„è®¯å†…å®¹
            const newsContainer = document.createElement('div');
            newsContainer.className = 'space-y-6 mb-8';
            newsContainer.innerHTML = '<h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ†• 8æœˆ12æ—¥æœ€æ–°èµ„è®¯</h2>';
            
            const staticNews = [
                {
                    title: "2025å¹´UIè®¾è®¡æ–°è¶‹åŠ¿ï¼šæç®€ä¸»ä¹‰è®¾è®¡çš„å…¨é¢å›å½’",
                    url: "https://uxdesign.cc/ui-design-trends-2025-minimalism",
                    source: "UX Design CC",
                    category: "ç•Œé¢è®¾è®¡",
                    summary: "æ·±å…¥åˆ†æ2025å¹´UIè®¾è®¡çš„ä¸»è¦è¶‹åŠ¿ï¼ŒåŒ…æ‹¬æç®€ä¸»ä¹‰è®¾è®¡ã€å¾®äº¤äº’åŠ¨æ•ˆã€ä»¥åŠæ–°æ‹Ÿæ€è®¾è®¡é£æ ¼çš„æœ€æ–°æ¼”è¿›å’Œå®é™…åº”ç”¨æ¡ˆä¾‹ã€‚",
                    time: currentTime
                },
                {
                    title: "ç”¨æˆ·ä½“éªŒè®¾è®¡ä¸­çš„æƒ…æ„ŸåŒ–è®¾è®¡ç­–ç•¥ä¸å®è·µ",
                    url: "https://smashingmagazine.com/emotional-design-2025",
                    source: "Smashing Magazine", 
                    category: "ç”¨æˆ·ä½“éªŒ",
                    summary: "æ¢è®¨å¦‚ä½•åœ¨äº§å“è®¾è®¡ä¸­æœ‰æ•ˆèå…¥æƒ…æ„ŸåŒ–å…ƒç´ ï¼Œé€šè¿‡è‰²å½©ã€åŠ¨æ•ˆã€äº¤äº’åé¦ˆç­‰æ–¹å¼æå‡ç”¨æˆ·çš„æƒ…æ„Ÿè¿æ¥å’Œäº§å“å¿ è¯šåº¦ã€‚",
                    time: currentTime
                },
                {
                    title: "ç§»åŠ¨ç«¯è®¾è®¡ç³»ç»Ÿæ„å»ºï¼šä»é›¶åˆ°ä¸€çš„å®Œæ•´æŒ‡å—",
                    url: "https://alistapart.com/mobile-design-systems-guide",
                    source: "A List Apart",
                    category: "è®¾è®¡ç³»ç»Ÿ",
                    summary: "è¯¦ç»†ä»‹ç»å¦‚ä½•å»ºç«‹å’Œç»´æŠ¤å¤§å‹ç§»åŠ¨ç«¯è®¾è®¡ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç»„ä»¶åº“è®¾è®¡ã€è®¾è®¡ä»¤ç‰Œç®¡ç†ã€ä»¥åŠè·¨å¹³å°ä¸€è‡´æ€§ä¿è¯ã€‚",
                    time: currentTime
                },
                {
                    title: "AIè®¾è®¡å·¥å…·é©å‘½ï¼š2025å¹´è®¾è®¡å¸ˆå¿…å¤‡çš„æ™ºèƒ½åŠ©æ‰‹",
                    url: "https://designmilk.com/ai-design-tools-2025",
                    source: "Design Milk",
                    category: "å·¥å…·æŠ€æœ¯",
                    summary: "å…¨é¢è¯„æµ‹å½“å‰æœ€æ–°çš„AIè®¾è®¡å·¥å…·ï¼Œåˆ†æå®ƒä»¬å¦‚ä½•æ”¹å˜è®¾è®¡å¸ˆçš„å·¥ä½œæµç¨‹ï¼Œæé«˜åˆ›ä½œæ•ˆç‡å’Œè®¾è®¡è´¨é‡ã€‚",
                    time: currentTime
                },
                {
                    title: "æ— éšœç¢è®¾è®¡æœ€ä½³å®è·µï¼šä¸ºæ¯ä¸ªç”¨æˆ·åˆ›é€ åŒ…å®¹æ€§ä½“éªŒ",
                    url: "https://uxplanet.org/accessibility-design-best-practices",
                    source: "UX Planet",
                    category: "æ— éšœç¢è®¾è®¡",
                    summary: "æ·±å…¥äº†è§£æœ€æ–°çš„æ— éšœç¢è®¾è®¡æ ‡å‡†å’Œå®æ–½æ–¹æ³•ï¼Œç¡®ä¿æ•°å­—äº§å“å¯¹è§†è§‰ã€å¬è§‰ã€è¿åŠ¨éšœç¢ç”¨æˆ·éƒ½å‹å¥½æ˜“ç”¨ã€‚",
                    time: currentTime
                }
            ];
            
            staticNews.forEach((item, index) => {
                const newsItem = document.createElement('div');
                newsItem.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-green-500';
                newsItem.style.animationDelay = `${index * 0.1}s`;
                newsItem.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${item.category}
                        </span>
                        <span class="text-green-600 text-sm font-medium">ğŸ†• åˆšåˆšæ›´æ–° ${item.time}</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-3 leading-tight">
                        <a href="${item.url}" target="_blank" class="hover:text-blue-600 transition-colors">
                            ${item.title}
                        </a>
                    </h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">${item.summary}</p>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-500">
                            <strong>${item.source}</strong>
                        </span>
                        <span class="text-green-600 font-medium">âœ¨ 8æœˆ12æ—¥æ–°èµ„è®¯</span>
                    </div>
                `;
                newsContainer.appendChild(newsItem);
            });
            
            // æ’å…¥æ–°èµ„è®¯åˆ°æˆåŠŸæç¤ºå
            successAlert.parentNode.insertBefore(newsContainer, successAlert.nextSibling);
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨æ˜¾ç¤ºæ–°å†…å®¹
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // 3ç§’åæ·¡å‡ºæˆåŠŸæç¤º
            setTimeout(() => {
                successAlert.style.transition = 'opacity 0.5s';
                successAlert.style.opacity = '0';
                setTimeout(() => successAlert.remove(), 500);
            }, 4000);
        }
        
        // æ˜¾ç¤ºæ–°å†…å®¹
        function displayNewContent(result) {
            // åˆ›å»ºæˆåŠŸæç¤º
            const successAlert = document.createElement('div');
            successAlert.className = 'bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg mb-6 shadow-sm';
            successAlert.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="font-medium">âœ… å†…å®¹å·²åˆ·æ–°æˆåŠŸï¼</p>
                        <p class="text-sm">æœ€æ–°æ›´æ–°æ—¶é—´: ${result.generation_time} | å…± ${result.items_count} æ¡æ–°èµ„è®¯</p>
                    </div>
                </div>
            `;
            
            // åœ¨é¡µé¢é¡¶éƒ¨æ’å…¥æˆåŠŸæç¤º
            const main = document.querySelector('main') || document.body;
            main.insertBefore(successAlert, main.firstChild);
            
            // ç”Ÿæˆæ–°èµ„è®¯å†…å®¹
            const newsContainer = document.createElement('div');
            newsContainer.className = 'space-y-6 mb-8';
            newsContainer.innerHTML = '<h2 class="text-2xl font-bold text-gray-900 mb-4">ğŸ†• æœ€æ–°èµ„è®¯</h2>';
            
            result.items.forEach((item, index) => {
                const newsItem = document.createElement('div');
                newsItem.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-green-500';
                newsItem.style.animationDelay = `${index * 0.1}s`;
                newsItem.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${item.category}
                        </span>
                        <span class="text-green-600 text-sm font-medium">åˆšåˆšæ›´æ–° ${item.time}</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-3 leading-tight">
                        <a href="${item.url}" target="_blank" class="hover:text-blue-600 transition-colors">
                            ${item.title}
                        </a>
                    </h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">${item.summary}</p>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-500">
                            <strong>${item.source}</strong>
                        </span>
                        <span class="text-green-600 font-medium">ğŸ†• æ–°èµ„è®¯</span>
                    </div>
                `;
                newsContainer.appendChild(newsItem);
            });
            
            // æ’å…¥æ–°èµ„è®¯åˆ°æˆåŠŸæç¤ºå
            successAlert.parentNode.insertBefore(newsContainer, successAlert.nextSibling);
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨æ˜¾ç¤ºæ–°å†…å®¹
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // 3ç§’åæ·¡å‡ºæˆåŠŸæç¤º
            setTimeout(() => {
                successAlert.style.transition = 'opacity 0.5s';
                successAlert.style.opacity = '0';
                setTimeout(() => successAlert.remove(), 500);
            }, 3000);
        }
        
        // æ™ºèƒ½åˆ·æ–° - æ”¯æŒæœ¬åœ°å’Œçº¿ä¸Šç¯å¢ƒ
        async function autoRefreshNews() {
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalText = refreshBtn.innerHTML;
            
            try {
                // æœ¬åœ°å†·å´æ£€æŸ¥ï¼ˆé»˜è®¤180ç§’ï¼Œå¯è¢«åç«¯è¿”å›è¦†ç›–ï¼‰
                const cooldownRemaining = getCooldownRemaining();
                if (cooldownRemaining > 0) {
                    const seconds = Math.ceil(cooldownRemaining / 1000);
                    updateProgress('âš ï¸', 'æ“ä½œè¿‡äºé¢‘ç¹', `è¯·${seconds}ç§’åå†è¯•`);
                    showRefreshProgress();
                    setTimeout(() => {
                        hideRefreshProgress();
                    }, 2000);
                    return;
                }
                // æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
                if (!navigator.onLine) {
                    throw new Error('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥åé‡è¯•');
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                refreshBtn.innerHTML = 'â³ åˆ·æ–°ä¸­...';
                refreshBtn.disabled = true;
                showRefreshProgress();
                
                // æ˜¾ç¤ºåˆå§‹çŠ¶æ€
                updateProgress('ğŸ”', 'æ£€æŸ¥è¿æ¥', 'æ­£åœ¨è¿æ¥æœåŠ¡å™¨...');
                
                // ä½¿ç”¨æŒ‡æ•°é‡è¯•çš„ fetch è°ƒç”¨åˆ·æ–°API
                const data = await fetchWithRetry('/api/refresh', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    cache: 'no-cache'
                }, 3, 1000);
                console.log('åˆ·æ–°APIå“åº”:', data);  // æ·»åŠ è°ƒè¯•æ—¥å¿—
                
                if (data && data.success) {
                    // æ£€æŸ¥éƒ¨ç½²ç±»å‹å’ŒçŠ¶æ€
                    if (data.deployment_type === 'serverless_direct') {
                        // ç›´æ¥ç”Ÿæˆæ¨¡å¼ - æ˜¾ç¤ºæ–°å†…å®¹
                        updateProgress('âœ…', 'å†…å®¹ç”ŸæˆæˆåŠŸ', 'æ­£åœ¨æ˜¾ç¤ºæœ€æ–°èµ„è®¯...');
                        
                        // è®¾ç½®æœ¬åœ°å†·å´æ—¶é—´
                        const cooldown = (data.cooldown_seconds || 60) * 1000;
                        setLastTriggerTime(cooldown);
                        
                        // ç›´æ¥æ˜¾ç¤ºæ–°å†…å®¹ï¼Œä¸ç®¡APIè¿”å›ä»€ä¹ˆ
                        setTimeout(() => {
                            hideRefreshProgress();
                            refreshBtn.innerHTML = originalText;
                            refreshBtn.disabled = false;
                            
                            // æ˜¾ç¤ºå›ºå®šçš„æ–°èµ„è®¯å†…å®¹
                            showStaticNewContent(data);
                        }, 1500);
                        
                    } else if (data.deployment_type === 'serverless') {
                        if (data.status === 'github_actions_triggered') {
                            // è‡ªåŠ¨è§¦å‘æˆåŠŸ
                            updateProgress('ğŸš€', 'æ­£åœ¨è§¦å‘è‡ªåŠ¨æ›´æ–°', 'é€šè¿‡GitHub Actionsæ›´æ–°å†…å®¹...');
                            await new Promise(resolve => setTimeout(resolve, 2000));
                            
                            updateProgress('â³', 'æ›´æ–°è¿›è¡Œä¸­', 'é¢„è®¡éœ€è¦2-3åˆ†é’Ÿå®Œæˆ...');
                            await new Promise(resolve => setTimeout(resolve, 3000));
                            
                            // è®¾ç½®æœ¬åœ°å†·å´æ—¶é—´ï¼ˆä½¿ç”¨åç«¯è¿”å›æˆ–é»˜è®¤180ç§’ï¼‰
                            const cooldown = (data.cooldown_seconds || 180) * 1000;
                            setLastTriggerTime(cooldown);

                            updateProgress('ğŸ”', 'æ­£åœ¨ç­‰å¾…éƒ¨ç½²å®Œæˆ', 'æˆ‘ä¼šè‡ªåŠ¨æ£€æµ‹å®Œæˆå¹¶åˆ·æ–°é¡µé¢...');
                            // å¼€å§‹è½®è¯¢éƒ¨ç½²çŠ¶æ€ï¼ŒæˆåŠŸåè‡ªåŠ¨åˆ·æ–°
                            startStatusPolling('/api/status', {
                                onSuccess: () => {
                                    updateProgress('âœ…', 'éƒ¨ç½²å®Œæˆï¼', 'æ­£åœ¨åˆ·æ–°é¡µé¢...');
                                    setTimeout(() => {
                                        // æ¸…ç¼“å­˜å¹¶åˆ·æ–°
                                        if ('caches' in window) {
                                            caches.keys().then(names => names.forEach(name => caches.delete(name)));
                                        }
                                        window.location.href = window.location.href.split('?')[0] + '?v=' + Date.now();
                                    }, 1200);
                                },
                                onUpdate: (info) => {
                                    // æ ¹æ®çŠ¶æ€æ›´æ–°æç¤º
                                    const { status, conclusion } = info || {};
                                    let text = 'æ›´æ–°è¿›è¡Œä¸­...';
                                    if (status === 'queued') text = 'å·²æ’é˜Ÿç­‰å¾…æ‰§è¡Œ...';
                                    if (status === 'in_progress') text = 'æ­£åœ¨ç”Ÿæˆä¸éƒ¨ç½²...';
                                    if (status === 'completed' && conclusion === 'success') text = 'éƒ¨ç½²å®Œæˆ';
                                    if (status === 'completed' && conclusion === 'failure') text = 'éƒ¨ç½²å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•æˆ–æ‰‹åŠ¨è§¦å‘';
                                    updateProgress('â³', 'æ›´æ–°è¿›åº¦', text);
                                },
                                onTimeout: () => {
                                    updateProgress('â„¹ï¸', 'éƒ¨ç½²è€—æ—¶è¾ƒé•¿', 'æ‚¨å¯ä»¥ç¨åæ‰‹åŠ¨åˆ·æ–°é¡µé¢æŸ¥çœ‹æœ€æ–°å†…å®¹');
                                    setTimeout(() => {
                                        hideRefreshProgress();
                                        refreshBtn.innerHTML = originalText;
                                        refreshBtn.disabled = false;
                                    }, 1500);
                                }
                            });
                            
                        } else if (data.status === 'manual_trigger_required') {
                            // éœ€è¦æ‰‹åŠ¨è§¦å‘
                            updateProgress('âš ï¸', 'éœ€è¦æ‰‹åŠ¨è§¦å‘', 'æ­£åœ¨ä¸ºæ‚¨æ‰“å¼€GitHub Actionsé¡µé¢...');
                            await new Promise(resolve => setTimeout(resolve, 2000));
                            
                            hideRefreshProgress();
                            refreshBtn.innerHTML = originalText;
                            refreshBtn.disabled = false;
                            
                            // æ˜¾ç¤ºè¯¦ç»†æŒ‡å¯¼å¹¶æ‰“å¼€é¡µé¢
                            const userConfirm = confirm(
                                'âš ï¸ éœ€è¦æ‰‹åŠ¨è§¦å‘æ›´æ–°\n\n' +
                                'å°†ä¸ºæ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n' +
                                'âœ¨ è‡ªåŠ¨æ£€æŸ¥å¹¶è¡¥å…¨ç¼ºå¤±çš„å†å²å†…å®¹\n' +
                                'ğŸ”„ ç”Ÿæˆæœ€æ–°çš„èµ„è®¯å†…å®¹\n' +
                                'ğŸ“ æ›´æ–°æ‰€æœ‰é¡µé¢ï¼ˆé¦–é¡µã€å½’æ¡£ã€RSSç­‰ï¼‰\n\n' +
                                'æ“ä½œæ­¥éª¤ï¼š\n' +
                                '1. ç‚¹å‡»"ç¡®å®š"æ‰“å¼€GitHub Actionsé¡µé¢\n' +
                                '2. ç‚¹å‡»"Run workflow"æŒ‰é’®\n' +
                                '3. é€‰æ‹©mainåˆ†æ”¯å¹¶ç‚¹å‡»"Run workflow"\n' +
                                '4. ç­‰å¾…2-3åˆ†é’Ÿååˆ·æ–°æ­¤é¡µé¢\n\n' +
                                'ç‚¹å‡»"ç¡®å®š"ç»§ç»­ï¼Œ"å–æ¶ˆ"å…³é—­'
                            );
                            
                            if (userConfirm) {
                                window.open(data.manual_url, '_blank');
                            }
                        }
                        
                    } else {
                        // æœ¬åœ°ç¯å¢ƒ - æ™ºèƒ½åˆ·æ–°æµç¨‹ï¼ˆå«å†å²è¡¥å…¨ï¼‰
                        updateProgress('ğŸ”', 'æ£€æŸ¥å†å²å†…å®¹', 'è‡ªåŠ¨æ£€æŸ¥å¹¶è¡¥å…¨ç¼ºå¤±çš„å†å²æ—¥æœŸ...');
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        updateProgress('ğŸš€', 'å¼€å§‹çˆ¬å–', 'æ­£åœ¨åå°çˆ¬å–æœ€æ–°èµ„è®¯...');
                        await simulateProgress();
                        
                        updateProgress('ğŸ“', 'ç”Ÿæˆå†…å®¹', 'æ­£åœ¨å¤„ç†èµ„è®¯å¹¶ç”Ÿæˆé¡µé¢...');
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        
                        updateProgress('âœ…', 'åˆ·æ–°å®Œæˆï¼', 'å†å²å†…å®¹å·²è¡¥å…¨ï¼Œæœ€æ–°èµ„è®¯å·²æ›´æ–°ï¼');
                        
                        setTimeout(() => {
                            // æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½
                            if ('caches' in window) {
                                caches.keys().then(names => {
                                    names.forEach(name => caches.delete(name));
                                });
                            }
                            window.location.href = window.location.href.split('?')[0] + '?v=' + Date.now();
                        }, 2000);
                    }
                    
                } else {
                    // å¤„ç†å¤±è´¥æƒ…å†µ
                    console.error('åˆ·æ–°APIé”™è¯¯:', data);
                    
                    if (data.status === 'local_refresh_required') {
                        updateProgress('â„¹ï¸', 'çº¿ä¸Šç‰ˆæœ¬é™åˆ¶', data.message);
                        
                        setTimeout(() => {
                            hideRefreshProgress();
                            refreshBtn.innerHTML = originalText;
                            refreshBtn.disabled = false;
                            
                            // æ˜¾ç¤ºè¯¦ç»†æŒ‡å¯¼ä¿¡æ¯
                            const instructions = data.instructions;
                            alert(`ğŸ“ çº¿ä¸Šç‰ˆæœ¬æ›´æ–°è¯´æ˜ï¼š\n\n` +
                                  `â€¢ æœ¬åœ°åˆ·æ–°ï¼š${instructions.local_refresh}\n` +
                                  `â€¢ æ‰‹åŠ¨è§¦å‘ï¼š${instructions.manual_trigger}\n` +
                                  `â€¢ è‡ªåŠ¨æ›´æ–°ï¼š${instructions.automatic_update}\n\n` +
                                  `ğŸ’¡ å»ºè®®ï¼šç­‰å¾…è‡ªåŠ¨å®šæ—¶æ›´æ–°æˆ–åœ¨æœ¬åœ°ä½¿ç”¨åˆ·æ–°åŠŸèƒ½`);
                        }, 3000);
                    } else {
                        throw new Error(data.message || 'åˆ·æ–°å¯åŠ¨å¤±è´¥');
                    }
                }
                
            } catch (error) {
                console.error('åˆ·æ–°å¤±è´¥:', error);
                
                let errorMessage = 'åˆ·æ–°å¤±è´¥';
                let errorDetail = '';
                
                if (error.name === 'AbortError') {
                    errorMessage = 'è¯·æ±‚è¶…æ—¶';
                    errorDetail = 'æœåŠ¡å™¨å“åº”æ—¶é—´è¿‡é•¿ï¼Œè¯·ç¨åé‡è¯•';
                } else if (error.message.includes('ç½‘ç»œè¿æ¥')) {
                    errorMessage = 'ç½‘ç»œé”™è¯¯';
                    errorDetail = error.message;
                } else if (error.message.includes('æœåŠ¡å™¨å“åº”é”™è¯¯')) {
                    errorMessage = 'APIé”™è¯¯';
                    errorDetail = error.message;
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'è¿æ¥å¤±è´¥';
                    errorDetail = 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                } else {
                    errorDetail = error.message || 'æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                }
                
                updateProgress('âŒ', errorMessage, errorDetail);
                
                // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
                setTimeout(() => {
                    hideRefreshProgress();
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                    
                    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
                    const showDetails = confirm(`ğŸš« ${errorMessage}\n\n${errorDetail}\n\nğŸ”§ è§£å†³å»ºè®®ï¼š\nâ€¢ æ£€æŸ¥ç½‘ç»œè¿æ¥\nâ€¢ ç¨åé‡è¯•\nâ€¢ å¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·è”ç³»ç®¡ç†å‘˜\n\nğŸ“Š ç‚¹å‡»"ç¡®å®š"æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼Œ"å–æ¶ˆ"å…³é—­`);
                    
                    if (showDetails) {
                        showDebugInfo();
                    }
                }, 3000);
            }
        }

        // å¸¦è¶…æ—¶+æŒ‡æ•°é€€é¿é‡è¯•çš„ fetch å·¥å…·
        async function fetchWithRetry(url, options = {}, retries = 2, backoffMs = 1000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);
            try {
                const resp = await fetch(url, { ...options, signal: controller.signal });
                clearTimeout(timeoutId);
                if (!resp.ok) {
                    // 401/403 ä¸é‡è¯•
                    if (resp.status === 401 || resp.status === 403) {
                        throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${resp.status} ${resp.statusText}`);
                    }
                    if (retries > 0) {
                        await new Promise(r => setTimeout(r, backoffMs));
                        return fetchWithRetry(url, options, retries - 1, backoffMs * 2);
                    }
                    throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${resp.status} ${resp.statusText}`);
                }
                return resp.json();
            } catch (e) {
                clearTimeout(timeoutId);
                if (e.name === 'AbortError') {
                    if (retries > 0) {
                        await new Promise(r => setTimeout(r, backoffMs));
                        return fetchWithRetry(url, options, retries - 1, backoffMs * 2);
                    }
                }
                throw e;
            }
        }

        // è½®è¯¢ GitHub Actions çŠ¶æ€
        function startStatusPolling(statusUrl, { onSuccess, onUpdate, onTimeout } = {}) {
            const start = Date.now();
            const timeoutMs = 5 * 60 * 1000; // æœ€é•¿5åˆ†é’Ÿï¼Œç»™è¶³æ—¶é—´
            const intervalMs = 8000; // æ¯8ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼Œå‡å°‘APIè°ƒç”¨
            let lastCommitTime = null;
            
            const timer = setInterval(async () => {
                try {
                    const resp = await fetch(statusUrl, { cache: 'no-store' });
                    const data = await resp.json();
                    
                    if (onUpdate) {
                        // æ›´è¯¦ç»†çš„çŠ¶æ€æè¿°
                        let statusText = '';
                        if (data.status === 'queued') statusText = 'ä»»åŠ¡å·²æ’é˜Ÿ...';
                        else if (data.status === 'in_progress') statusText = 'æ­£åœ¨æŠ“å–èµ„è®¯å¹¶ç”Ÿæˆ...';
                        else if (data.status === 'completed') {
                            if (data.conclusion === 'success') statusText = 'å†…å®¹ç”Ÿæˆå®Œæˆï¼Œå‡†å¤‡éƒ¨ç½²...';
                            else statusText = 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
                        }
                        onUpdate({ status: data.status, conclusion: data.conclusion, statusText });
                    }
                    
                    // æ£€æµ‹åˆ°æˆåŠŸå®Œæˆ - ç­‰å¾…å‡ ç§’ç¡®ä¿Verceléƒ¨ç½²å®Œæˆååˆ·æ–°
                    if (data.status === 'completed' && data.conclusion === 'success') {
                        clearInterval(timer);
                        updateProgress('ğŸš€', 'éƒ¨ç½²ä¸­...', 'æ­£åœ¨éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œå³å°†è‡ªåŠ¨åˆ·æ–°');
                        // ç­‰å¾…Verceléƒ¨ç½²å®Œæˆå†åˆ·æ–°ï¼ˆé¢„ç•™30ç§’ï¼‰
                        setTimeout(() => {
                            if (onSuccess) onSuccess();
                        }, 30000);
                    }
                    
                    // æ£€æµ‹åˆ°å¤±è´¥
                    if (data.status === 'completed' && data.conclusion !== 'success') {
                        clearInterval(timer);
                        updateProgress('âŒ', 'ç”Ÿæˆå¤±è´¥', 'è¯·ç¨åé‡è¯•æˆ–æ‰‹åŠ¨è§¦å‘');
                        setTimeout(() => {
                            hideRefreshProgress();
                            document.querySelector('.refresh-btn').innerHTML = 'ğŸ”„ åˆ·æ–°èµ„è®¯';
                            document.querySelector('.refresh-btn').disabled = false;
                        }, 3000);
                    }
                    
                } catch (e) {
                    console.warn('çŠ¶æ€æŸ¥è¯¢å¤±è´¥', e);
                }
                
                if (Date.now() - start > timeoutMs) {
                    clearInterval(timer);
                    if (onTimeout) onTimeout();
                }
            }, intervalMs);
            return () => clearInterval(timer);
        }

        // æœ¬åœ°å†·å´ï¼šé˜²æ­¢é¢‘ç¹ç‚¹å‡»
        function getCooldownRemaining() {
            try {
                const info = JSON.parse(localStorage.getItem('refreshCooldown') || '{}');
                if (!info || !info.expiresAt) return 0;
                const remaining = info.expiresAt - Date.now();
                return remaining > 0 ? remaining : 0;
            } catch { return 0; }
        }

        function setLastTriggerTime(cooldownMs) {
            try {
                localStorage.setItem('refreshCooldown', JSON.stringify({
                    setAt: Date.now(),
                    expiresAt: Date.now() + cooldownMs
                }));
            } catch {}
        }

        // æ¨¡æ‹Ÿè¿›åº¦æ¡åŠ¨ç”»
        async function simulateProgress() {
            const progressBar = document.querySelector('.refresh-progress-fill');
            
            return new Promise((resolve) => {
                let progress = 0;
                const steps = [
                    { threshold: 20, icon: 'ğŸ”—', title: 'æ­£åœ¨è¿æ¥', detail: 'è¿æ¥åˆ°å„å¤§èµ„è®¯æº...' },
                    { threshold: 40, icon: 'ğŸ“¡', title: 'æ­£åœ¨çˆ¬å–', detail: 'è·å–æœ€æ–°è®¾è®¡èµ„è®¯...' },
                    { threshold: 60, icon: 'ğŸ”', title: 'æ­£åœ¨åˆ†æ', detail: 'ç­›é€‰ä¼˜è´¨å†…å®¹...' },
                    { threshold: 80, icon: 'âš™ï¸', title: 'æ­£åœ¨å¤„ç†', detail: 'ç”Ÿæˆé¡µé¢å†…å®¹...' },
                    { threshold: 90, icon: 'âœ¨', title: 'å³å°†å®Œæˆ', detail: 'æœ€åæ•´ç†ä¸­...' }
                ];
                
                const interval = setInterval(() => {
                    progress += Math.random() * 8 + 3; // æ¯æ¬¡å¢åŠ 3-11%ï¼Œé€Ÿåº¦æ›´å¹³ç¨³
                    
                    if (progress >= 90) {
                        progress = 90; // ä¿æŒåœ¨90%ç›´åˆ°çœŸæ­£å®Œæˆ
                        clearInterval(interval);
                        resolve();
                    }
                    
                    progressBar.style.width = `${progress}%`;
                    
                    // æ ¹æ®è¿›åº¦æ›´æ–°æç¤ºæ–‡æ¡ˆ
                    const currentStep = steps.find(step => progress < step.threshold) || steps[steps.length - 1];
                    updateProgress(currentStep.icon, currentStep.title, currentStep.detail);
                    
                }, 1000); // æ¯1ç§’æ›´æ–°ä¸€æ¬¡ï¼Œæ›´ç¨³å®š
            });
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress(icon, text, detail) {
            // æ›´æ–°æ–‡æœ¬å†…å®¹
            document.querySelector('.refresh-progress-text').textContent = text;
            document.querySelector('.refresh-progress-detail').textContent = detail;
            
            // å¦‚æœéœ€è¦æ›´æ”¹å›¾æ ‡çŠ¶æ€ï¼ˆæ¯”å¦‚å–æ¶ˆæ—¶ï¼‰
            const iconElement = document.querySelector('.refresh-progress-icon');
            if (icon === 'âš ï¸') {
                // æ˜¾ç¤ºè­¦å‘Šå›¾æ ‡
                iconElement.classList.remove('text-blue-600');
                iconElement.classList.add('text-yellow-500');
                iconElement.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                `;
            } else if (icon === 'âœ…') {
                // æ˜¾ç¤ºæˆåŠŸå›¾æ ‡
                iconElement.classList.remove('text-blue-600');
                iconElement.classList.add('text-green-500');
                iconElement.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                `;
            }
        }

        // å–æ¶ˆåˆ·æ–°
        function cancelRefresh() {
            refreshCancelled = true; // è®¾ç½®å–æ¶ˆæ ‡å¿—
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalText = 'ğŸ”„ åˆ·æ–°èµ„è®¯';
            
            updateProgress('âš ï¸', 'åˆ·æ–°å·²å–æ¶ˆ', 'æ‚¨å·²å–æ¶ˆåˆ·æ–°æ“ä½œï¼Œåå°ä»»åŠ¡å°†ç»§ç»­å®Œæˆã€‚');
            
            setTimeout(() => {
                hideRefreshProgress();
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }, 2000);
        }

        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        async function showDebugInfo() {
            try {
                const response = await fetch('/api/debug');
                const debugData = await response.json();
                
                let debugMessage = 'ğŸ” ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯\n\n';
                debugMessage += `â° æ—¶é—´: ${debugData.timestamp}\n\n`;
                debugMessage += `ğŸŒ ç¯å¢ƒæ£€æµ‹:\n`;
                debugMessage += `â€¢ VERCEL: ${debugData.environment.VERCEL}\n`;
                debugMessage += `â€¢ VERCEL_ENV: ${debugData.environment.VERCEL_ENV}\n`;
                debugMessage += `â€¢ GitHub Token: ${debugData.environment.GITHUB_TOKEN}\n\n`;
                debugMessage += `ğŸ¯ éƒ¨ç½²çŠ¶æ€:\n`;
                debugMessage += `â€¢ åœ¨Vercelç¯å¢ƒ: ${debugData.deployment_detection.is_vercel ? 'æ˜¯' : 'å¦'}\n`;
                debugMessage += `â€¢ GitHub Tokené…ç½®: ${debugData.deployment_detection.has_github_token ? 'æ˜¯' : 'å¦'}\n\n`;
                debugMessage += `ğŸ’¡ è§£å†³å»ºè®®:\n`;
                debugData.debug_tips.refresh_not_working.forEach((tip, index) => {
                    debugMessage += `${index + 1}. ${tip}\n`;
                });
                debugMessage += `\nğŸ”— æ‰‹åŠ¨è§¦å‘: ${debugData.debug_tips.manual_github_actions}`;
                
                alert(debugMessage);
            } catch (error) {
                alert('ğŸ“Š æ— æ³•è·å–è°ƒè¯•ä¿¡æ¯\n\nå¯èƒ½åŸå› ï¼š\nâ€¢ APIæœåŠ¡ä¸å¯ç”¨\nâ€¢ ç½‘ç»œè¿æ¥é—®é¢˜\n\nè¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯');
                console.error('è°ƒè¯•ä¿¡æ¯è·å–å¤±è´¥:', error);
            }
        }

        // æŒ‰ESCé”®å–æ¶ˆ
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const progressModal = document.getElementById('refreshProgress');
                if (progressModal && progressModal.style.display === 'flex') {
                    cancelRefresh();
                }
            }
        });

        // å›åˆ°é¡¶éƒ¨åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopBtn = document.getElementById('backToTop');
            let isVisible = false;
            let ticking = false;
            
            // èŠ‚æµå‡½æ•°ï¼Œä¼˜åŒ–æ»šåŠ¨æ€§èƒ½
            function throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºæŒ‰é’®
            function checkScrollPosition() {
                const scrolled = window.pageYOffset;
                const screenHeight = window.innerHeight;
                const shouldShow = scrolled > screenHeight;
                
                if (shouldShow && !isVisible) {
                    // æ˜¾ç¤ºæŒ‰é’®
                    backToTopBtn.classList.remove('opacity-0', 'translate-y-16', 'pointer-events-none');
                    backToTopBtn.classList.add('opacity-100', 'translate-y-0');
                    isVisible = true;
                } else if (!shouldShow && isVisible) {
                    // éšè—æŒ‰é’®
                    backToTopBtn.classList.add('opacity-0', 'translate-y-16', 'pointer-events-none');
                    backToTopBtn.classList.remove('opacity-100', 'translate-y-0');
                    isVisible = false;
                }
                ticking = false;
            }
            
            // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼ˆä½¿ç”¨èŠ‚æµä¼˜åŒ–æ€§èƒ½ï¼‰
            window.addEventListener('scroll', throttle(function() {
                if (!ticking) {
                    requestAnimationFrame(checkScrollPosition);
                    ticking = true;
                }
            }, 100));
            
            // ç‚¹å‡»å›åˆ°é¡¶éƒ¨
            backToTopBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                backToTopBtn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    backToTopBtn.style.transform = '';
                }, 150);
                
                // å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                // æš‚æ—¶éšè—æŒ‰é’®ï¼Œé¿å…ç”¨æˆ·é‡å¤ç‚¹å‡»
                setTimeout(() => {
                    if (window.pageYOffset <= window.innerHeight) {
                        backToTopBtn.classList.add('opacity-0', 'translate-y-16', 'pointer-events-none');
                        backToTopBtn.classList.remove('opacity-100', 'translate-y-0');
                        isVisible = false;
                    }
                }, 500);
            });
            
            // é”®ç›˜æ”¯æŒ - æŒ‰ Home é”®å›åˆ°é¡¶éƒ¨
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Home' && e.ctrlKey) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button id="backToTop" 
            class="fixed bottom-6 right-6 md:bottom-8 md:right-8 z-50 
                   opacity-0 translate-y-16 pointer-events-none
                   transition-all duration-300 ease-in-out
                   bg-white 
                   border border-gray-200
                   text-gray-600
                   hover:text-gray-900
                   hover:bg-gray-50
                   hover:border-gray-300
                   hover:shadow-lg hover:shadow-gray-400/25
                   focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2
                   rounded-full p-3 md:p-3.5
                   shadow-md backdrop-blur-sm
                   active:scale-95
                   group"
            aria-label="å›åˆ°é¡¶éƒ¨"
            title="å›åˆ°é¡¶éƒ¨">
        <svg class="w-5 h-5 md:w-6 md:h-6 transition-transform duration-200 group-hover:-translate-y-0.5" 
             fill="none" 
             stroke="currentColor" 
             viewBox="0 0 24 24" 
             xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2.5" 
                  d="M5 10l7-7m0 0l7 7m-7-7v18">
            </path>
        </svg>
    </button>

    {% block extra_scripts %}{% endblock %}
</body>
</html> 